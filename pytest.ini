# pytest.ini
[pytest]
pythonpath = backend

minversion = 7.0

# Test discovery
testpaths =
    backend/tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Async tests (requires pytest-asyncio)
asyncio_mode = auto

# Useful defaults: strict markers, coverage, tidy output
addopts =
    --strict-markers
    --maxfail=1
    --cov=backend/app
    --cov=backend/main.py
    --cov-report=term-missing
    --no-cov-on-fail
    -q

# Define markers so --strict-markers doesnâ€™t complain
markers =
    unit: fast, isolated tests of functions/classes (no external network/Redis/OpenAI)
    integration: API-level tests using FastAPI app with dependency overrides (no real external services)
    smoke: minimal happy-path flow using fakes

# Keep noisy deprecations out of CI logs (tune as needed)
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

# Inline logging from tests and app code when failures occur
log_cli = true
log_cli_level = INFO

# Make xfail strict so unexpected passes fail the run
xfail_strict = true

# Speed up path resolution in large repos (optional)
norecursedirs =
    .git
    .venv
    venv
    node_modules
    dist
    build
